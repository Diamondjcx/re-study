# https

## what

HTTPS 是在 HTTP 上建立 SSL 加密层，并对传输数据进行加密，是 HTTP 协议的安全版。
HTTPS = HTTP + SSL/TLS 协议，位于 HTTP 协议与 TCP/IP 协议中间

作用：
（1）对数据进行加密，并建立一个信息安全通道，来保证传输过程中的数据安全。
（2）对网站服务器进行真实身份认证

## why

- 通信使用明文（不加密），内容可能被窃听
  HTTP 不具备加密功能，使用明文（未经过加密的报文）方式发送

- 无法证明报文的完整性，可能遭篡改

- 不验证通信方的身份，因此有可能遭遇伪装

HTTPS 优势

- 数据隐私性：内容经过对称加密，每个链接生成一个唯一的加密密钥
- 数据完整性：内容传输经过完整性校验
- 身份认证：第三方无法伪造服务端身份

## 解决 HTTP 问题

1、解决内容可能被窃听的问题---加密

对称加密：加密和解密都会用到密钥，没有密钥就无法对密码解密，反过来，任何人只要持有密钥就能解密了。

对称加密方式加密时必须将密钥也发送给对方。怎样安全的转交？

非对称加密：公开密钥加密使用一对非对称的密钥。一把叫做私有秘钥，另一把叫公开密钥。私有密钥不能让其他任何人知道，而公开密钥则可以随意发布，任何人都可以获得。

### 对称加密：

即通信的双⽅都使⽤同⼀个秘钥进⾏加解密，⽐如特务接头的暗号，就属于对称加密
对称加密虽然很简单性能也好，但是⽆法解决⾸次把秘钥发给对⽅的问题，很容易被⿊客拦截秘钥。

### ⾮对称加密：

1. 私钥 + 公钥= 密钥对
2. 即⽤私钥加密的数据,只有对应的公钥才能解密,⽤公钥加密的数据,只有对应的私钥才能解密
3. 因为通信双⽅的⼿⾥都有⼀套⾃⼰的密钥对,通信之前双⽅会先把⾃⼰的公钥都先发给对⽅
4. 然后对⽅再拿着这个公钥来加密数据响应给对⽅,等到到了对⽅那⾥,对⽅再⽤⾃⼰的私钥进⾏解密

⾮对称加密虽然安全性更⾼，但是带来的问题就是速度很慢，影响性能。

解决⽅案：
那么结合两种加密⽅式，将对称加密的密钥使⽤⾮对称加密的公钥进⾏加密，然后发送出去，接收⽅使⽤私钥进⾏解密 得到对称加密的密钥，然后双⽅可以使⽤对称加密来进⾏沟通。

此时⼜带来⼀个问题，
中间⼈问题： 如果此时在客户端和服务器之间存在⼀个中间⼈,这个中间⼈只需要把原本双⽅通信互发的公钥,换成⾃⼰的公钥,这样中间⼈就可以轻松解密通信双⽅所发送的所有数据。 所以这个时候需要⼀个安全的第三⽅颁发证书（CA），证明身份的身份，防⽌被中间⼈攻击。 证书中包括：签发者、证书⽤途、使⽤者公钥、使⽤者私钥、使⽤者的 HASH 算法、证书到期时间等

但是问题来了，如果中间⼈篡改了证书，那么身份证明是不是就⽆效了？

这个证明就⽩买了，这个时候需要⼀个新的技术，数字签名。
数字签名就是⽤ CA ⾃带的 HASH 算法对证书的内容进⾏ HASH 得到⼀个摘要，再⽤ CA 的私钥加密，最终组成数字签 名。当别⼈把他的证书发过来的时候,我再⽤同样的 Hash 算法,再次⽣成消息摘要，然后⽤ CA 的公钥对数字签名解密,得到 CA 创建的消息摘要,两者⼀⽐,就知道中间有没有被⼈篡改了。 这个时候就能最⼤程度保证通信的安全了。

对称加密：一个密钥
非对称加密：一对密钥
公钥负责加密
私钥负责解密
私钥无法解开说明公钥无效--抗抵赖
计算复杂对性能有影响（不适合传输极端情况下 1000 倍
常见的算法 RSA

# 对称加密

同一个密钥进行加密和解密
怎么样把密钥安全的发送给对方

# 非对称加密

客户端

服务器 私钥和公钥

CA 证书中心

1. 服务器证明自己是百度服务器；服务器的公钥传输给 CA 证书中心
2. CA 证书中心会签发送一个证书给服务器
3. 客户端向服务器发送 https 证书请求，https 访问服务器
4. 服务器将证书和公钥返回给客户端
5. 客户端会拿证书向 CA 证书询问有效性
6. 向客户端返回验证结果
7. 客户端会用公钥加密对称密钥
8. 服务器和客户端通过对称密钥通信

# 为何不是所有的网站都是用 HTTPS

1、HTTPS 实施有门槛，需要权威 CA 颁发的 SSL 证书。从证书的选择、购买到部署，传统模式下都会比较耗时耗力。

2、性能消耗要大于 HTTP，与纯文本通信相比，加密通信会消耗更多的 CPU 及内存资源。通过优化其实并不慢

3、购买证书的开销也是考虑原因之一

## 用信鸽来解释

1、 隐秘的密码

人物： 爱丽丝、鲍勃和马洛里

             通过信鸽

完美：爱丽丝 --------> 鲍勃

                  马洛里拦截信鸽，篡改信息

盗窃篡改： 爱丽丝 -------------------------> 鲍勃

1.1 解决：隐秘的密码书写信息 ---对称密钥加密

```
爱丽丝先对信息先进行加密，鲍勃拿到信息之后再进行反解密。加密方法只有爱丽丝和鲍勃知道。
```

问题：他们两个在传递信息之前，没有碰过头，没有一个安全的方式来确立密匙。马洛里会截获信息并发现密匙。中间人攻击

2、解决遗留问题 --- 非对称密钥加密

没有携带任何信息的鸽子
鲍勃-------------------->爱丽丝

    <------------------- 钥匙在爱丽丝手里保管
      开着锁的盒子

    --------------------> 爱丽丝收到盒子，用钥匙打开然后阅读信息
    信放进盒子里，锁上然后把盒子送给爱丽丝

    盒子被称为公匙，而用来打开盒子的钥匙被称为私匙

问题： 如何信任盒子？
当鲍勃收到盒子时他如何能确定这个盒子来自爱丽丝而不是马洛里截获了鸽子然后换了一个她有钥匙能打开的盒子呢？

解决：爱丽丝决定签名标记一下盒子，这样鲍勃收到盒子的时候就可以检查签名来确定是爱丽丝送出的盒子了。

那么鲍勃如何从一开始就能识别出爱丽丝的签名呢？

泰德代替爱丽丝标记这个盒子。很有名的一个值得信任的家伙，会给任何人签名并且都信任他只会给合法的人签名标记盒子。----认证机构。

如果泰德可以确认索要签名的人是爱丽丝，他就会在爱丽丝的盒子上签名。因此马洛里就不可能搞到一个有着泰德代表爱丽丝签了名的盒子，因为鲍勃知道泰德只会给他确认过的人签名，从而识破了马洛里的轨迹。

问题：沉重的盒子

让鸽子携带盒子比直接携带信件要慢一些

因此决定只有选择用对称加密给信息编码的密匙事，使用传递盒子的方法（非对称加密

这样就可以将二者的有点兼具了，非对称加密的可靠性和对称加密的高效性。

> > > 交换编码密匙的时候使用非对称加密技术，传送信息的时候使用对称加密
