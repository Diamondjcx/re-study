# 面试官：为什么说 HTTPS 比 HTTP 安全? HTTPS 是如何保证安全的？

![](https://static.vue-js.com/b5512250-b2ff-11eb-ab90-d9ae814b240d.png)

## 一、安全特性

在上篇文章中，我们了解到`HTTP`在通信过程中，存在以下问题：

- 通信使用明文（不加密），内容可能被窃听
- 不验证通信方的身份，因此有可能遭遇伪装

而`HTTPS`的出现正是解决这些问题，`HTTPS`是建立在`SSL`之上，其安全性由`SSL`来保证

在采用`SSL`后，`HTTP`就拥有了`HTTPS`的加密、证书和完整性保护这些功能

> SSL(Secure Sockets Layer 安全套接字协议),及其继任者传输层安全（Transport Layer Security，TLS）是为网络通信提供安全及数据完整性的一种安全协议

![](https://static.vue-js.com/cb559400-b2ff-11eb-85f6-6fac77c0c9b3.png)

## 二、如何做

`SSL `的实现这些功能主要依赖于三种手段：

- 对称加密：采用协商的密钥对数据加密
- 非对称加密：实现身份认证和密钥协商
- 摘要算法：验证信息的完整性
- 数字签名：身份验证

### 对称加密

对称加密指的是加密和解密使用的秘钥都是同一个，是对称的。只要保证了密钥的安全，那整个通信过程就可以说具有了机密性

![](https://static.vue-js.com/e3f040f0-b2ff-11eb-ab90-d9ae814b240d.png)

### 非对称加密

非对称加密，存在两个秘钥，一个叫公钥，一个叫私钥。两个秘钥是不同的，公钥可以公开给任何人使用，私钥则需要保密

公钥和私钥都可以用来加密解密，但公钥加密后只能用私钥解
密，反过来，私钥加密后也只能用公钥解密

![](https://static.vue-js.com/d9603e60-b2ff-11eb-ab90-d9ae814b240d.png)

### 混合加密

在`HTTPS`通信过程中，采用的是对称加密+非对称加密，也就是混合加密

在对称加密中讲到，如果能够保证了密钥的安全，那整个通信过程就可以说具有了机密性

而`HTTPS`采用非对称加密解决秘钥交换的问题

具体做法是发送密文的一方使用对方的公钥进行加密处理“对称的密钥”，然后对方用自己的私钥解密拿到“对称的密钥”

![](https://static.vue-js.com/f375f290-b2ff-11eb-85f6-6fac77c0c9b3.png)

这样可以确保交换的密钥是安全的前提下，使用对称加密方式进行通信

#### 举个例子：

网站秘密保管私钥，在网上任意分发公钥，你想要登录网站只要用公钥加密就行了，密文只能由私钥持有者才能解密。而黑客因为没有私钥，所以就无法破解密文

上述的方法解决了数据加密，在网络传输过程中，数据有可能被篡改，并且黑客可以伪造身份发布公钥，如果你获取到假的公钥，那么混合加密也并无多大用处，你的数据扔被黑客解决

因此，在上述加密的基础上仍需加上完整性、身份验证的特性，来实现真正的安全，实现这一功能则是摘要算法

### 摘要算法

实现完整性的手段主要是摘要算法，也就是常说的散列函数、哈希函数

可以理解成一种特殊的压缩算法，它能够把任意长度的数据“压缩”成固定长度、而且独一无二的“摘要”字符串，就好像是给这段数据生成了一个数字“指纹”

![](https://static.vue-js.com/12798da0-b300-11eb-85f6-6fac77c0c9b3.png)

摘要算法保证了“数字摘要”和原文是完全等价的。所以，我们只要在原文后附上它的摘要，就能够保证数据的完整性

比如，你发了条消息：“转账 1000 元”，然后再加上一个 SHA-2 的摘要。网站收到后也计算一下消息的摘要，把这两份“指纹”做个对比，如果一致，就说明消息是完整可信的，没有被修改

![](https://static.vue-js.com/023790e0-b300-11eb-ab90-d9ae814b240d.png)

### 数字签名

数字签名能确定消息确实是由发送方签名并发出来的，因为别人假冒不了发送方的签名

原理其实很简单，就是用私钥加密，公钥解密

签名和公钥一样完全公开，任何人都可以获取。但这个签名只有用私钥对应的公钥才能解开，拿到摘要后，再比对原文验证完整性，就可以像签署文件一样证明消息确实是你发的

![](https://static.vue-js.com/21aa6880-b300-11eb-85f6-6fac77c0c9b3.png)

和消息本身一样，因为谁都可以发布公钥，我们还缺少防止黑客伪造公钥的手段，也就是说，怎么判断这个公钥就是你的公钥

这时候就需要一个第三方，就是证书验证机构

### CA 验证机构

数字证书认证机构处于客户端与服务器双方都可信赖的第三方机构的立场

CA 对公钥的签名认证要求包括序列号、用途、颁发者、有效时间等等，把这些打成一个包再签名，完整地证明公钥关联的各种信息，形成“数字证书”

流程如下图：

![](https://static.vue-js.com/395648a0-b300-11eb-85f6-6fac77c0c9b3.png)

- 服务器的运营人员向数字证书认证机构提出公开密钥的申请
- 数字证书认证机构在判明提出申请者的身份之后，会对已申请的公开密钥做数字签名
- 然后分配这个已签名的公开密钥，并将该公开密钥放入公钥证书后绑定在一起
- 服务器会将这份由数字证书认证机构颁发的数字证书发送给客户端，以进行非对称加密方式通信

接到证书的客户端可使用数字证书认证机构的公开密钥，对那张证书上的数字签名进行验证，一旦验证通过，则证明：

- 认证服务器的公开密钥的是真实有效的数字证书认证机构
- 服务器的公开密钥是值得信赖的

## 三、总结

可以看到，`HTTPS`与`HTTP`虽然只差一个`SSL`，但是通信安全得到了大大的保障，通信的四大特性都以解决，解决方式如下：

- 机密性：混合算法
- 完整性：摘要算法
- 身份认证：数字签名
- 不可否定：数字签名

同时引入第三方证书机构，确保公开秘钥的安全性

## what

HTTPS 是在 HTTP 上建立 SSL 加密层，并对传输数据进行加密，是 HTTP 协议的安全版。
HTTPS = HTTP + SSL/TLS 协议，位于 HTTP 协议与 TCP/IP 协议中间

作用：
（1）对数据进行加密，并建立一个信息安全通道，来保证传输过程中的数据安全。
（2）对网站服务器进行真实身份认证

## why

- 通信使用明文（不加密），内容可能被窃听
  HTTP 不具备加密功能，使用明文（未经过加密的报文）方式发送

- 无法证明报文的完整性，可能遭篡改

- 不验证通信方的身份，因此有可能遭遇伪装

HTTPS 优势

- 数据隐私性：内容经过对称加密，每个链接生成一个唯一的加密密钥
- 数据完整性：内容传输经过完整性校验
- 身份认证：第三方无法伪造服务端身份

## 解决 HTTP 问题

1、解决内容可能被窃听的问题---加密

对称加密：加密和解密都会用到密钥，没有密钥就无法对密码解密，反过来，任何人只要持有密钥就能解密了。

对称加密方式加密时必须将密钥也发送给对方。怎样安全的转交？

非对称加密：公开密钥加密使用一对非对称的密钥。一把叫做私有秘钥，另一把叫公开密钥。私有密钥不能让其他任何人知道，而公开密钥则可以随意发布，任何人都可以获得。

### 对称加密：

即通信的双⽅都使⽤同⼀个秘钥进⾏加解密，⽐如特务接头的暗号，就属于对称加密
对称加密虽然很简单性能也好，但是⽆法解决⾸次把秘钥发给对⽅的问题，很容易被⿊客拦截秘钥。

### ⾮对称加密：

1. 私钥 + 公钥= 密钥对
2. 即⽤私钥加密的数据,只有对应的公钥才能解密,⽤公钥加密的数据,只有对应的私钥才能解密
3. 因为通信双⽅的⼿⾥都有⼀套⾃⼰的密钥对,通信之前双⽅会先把⾃⼰的公钥都先发给对⽅
4. 然后对⽅再拿着这个公钥来加密数据响应给对⽅,等到到了对⽅那⾥,对⽅再⽤⾃⼰的私钥进⾏解密

⾮对称加密虽然安全性更⾼，但是带来的问题就是速度很慢，影响性能。

解决⽅案：
那么结合两种加密⽅式，将对称加密的密钥使⽤⾮对称加密的公钥进⾏加密，然后发送出去，接收⽅使⽤私钥进⾏解密 得到对称加密的密钥，然后双⽅可以使⽤对称加密来进⾏沟通。

此时⼜带来⼀个问题，
中间⼈问题： 如果此时在客户端和服务器之间存在⼀个中间⼈,这个中间⼈只需要把原本双⽅通信互发的公钥,换成⾃⼰的公钥,这样中间⼈就可以轻松解密通信双⽅所发送的所有数据。 所以这个时候需要⼀个安全的第三⽅颁发证书（CA），证明身份的身份，防⽌被中间⼈攻击。 证书中包括：签发者、证书⽤途、使⽤者公钥、使⽤者私钥、使⽤者的 HASH 算法、证书到期时间等

但是问题来了，如果中间⼈篡改了证书，那么身份证明是不是就⽆效了？

这个证明就⽩买了，这个时候需要⼀个新的技术，数字签名。
数字签名就是⽤ CA ⾃带的 HASH 算法对证书的内容进⾏ HASH 得到⼀个摘要，再⽤ CA 的私钥加密，最终组成数字签 名。当别⼈把他的证书发过来的时候,我再⽤同样的 Hash 算法,再次⽣成消息摘要，然后⽤ CA 的公钥对数字签名解密,得到 CA 创建的消息摘要,两者⼀⽐,就知道中间有没有被⼈篡改了。 这个时候就能最⼤程度保证通信的安全了。

对称加密：一个密钥
非对称加密：一对密钥
公钥负责加密
私钥负责解密
私钥无法解开说明公钥无效--抗抵赖
计算复杂对性能有影响（不适合传输极端情况下 1000 倍
常见的算法 RSA

# 对称加密

同一个密钥进行加密和解密
怎么样把密钥安全的发送给对方

# 非对称加密

客户端

服务器 私钥和公钥

CA 证书中心

1. 服务器证明自己是百度服务器；服务器的公钥传输给 CA 证书中心
2. CA 证书中心会签发送一个证书给服务器
3. 客户端向服务器发送 https 证书请求，https 访问服务器
4. 服务器将证书和公钥返回给客户端
5. 客户端会拿证书向 CA 证书询问有效性
6. 向客户端返回验证结果
7. 客户端会用公钥加密对称密钥
8. 服务器和客户端通过对称密钥通信

# 为何不是所有的网站都是用 HTTPS

1、HTTPS 实施有门槛，需要权威 CA 颁发的 SSL 证书。从证书的选择、购买到部署，传统模式下都会比较耗时耗力。

2、性能消耗要大于 HTTP，与纯文本通信相比，加密通信会消耗更多的 CPU 及内存资源。通过优化其实并不慢

3、购买证书的开销也是考虑原因之一

## 用信鸽来解释

1、 隐秘的密码

人物： 爱丽丝、鲍勃和马洛里

             通过信鸽

完美：爱丽丝 --------> 鲍勃

                  马洛里拦截信鸽，篡改信息

盗窃篡改： 爱丽丝 -------------------------> 鲍勃

1.1 解决：隐秘的密码书写信息 ---对称密钥加密

```
爱丽丝先对信息先进行加密，鲍勃拿到信息之后再进行反解密。加密方法只有爱丽丝和鲍勃知道。
```

问题：他们两个在传递信息之前，没有碰过头，没有一个安全的方式来确立密匙。马洛里会截获信息并发现密匙。中间人攻击

2、解决遗留问题 --- 非对称密钥加密

没有携带任何信息的鸽子
鲍勃-------------------->爱丽丝

    <------------------- 钥匙在爱丽丝手里保管
      开着锁的盒子

    --------------------> 爱丽丝收到盒子，用钥匙打开然后阅读信息
    信放进盒子里，锁上然后把盒子送给爱丽丝

    盒子被称为公匙，而用来打开盒子的钥匙被称为私匙

问题： 如何信任盒子？
当鲍勃收到盒子时他如何能确定这个盒子来自爱丽丝而不是马洛里截获了鸽子然后换了一个她有钥匙能打开的盒子呢？

解决：爱丽丝决定签名标记一下盒子，这样鲍勃收到盒子的时候就可以检查签名来确定是爱丽丝送出的盒子了。

那么鲍勃如何从一开始就能识别出爱丽丝的签名呢？

泰德代替爱丽丝标记这个盒子。很有名的一个值得信任的家伙，会给任何人签名并且都信任他只会给合法的人签名标记盒子。----认证机构。

如果泰德可以确认索要签名的人是爱丽丝，他就会在爱丽丝的盒子上签名。因此马洛里就不可能搞到一个有着泰德代表爱丽丝签了名的盒子，因为鲍勃知道泰德只会给他确认过的人签名，从而识破了马洛里的轨迹。

问题：沉重的盒子

让鸽子携带盒子比直接携带信件要慢一些

因此决定只有选择用对称加密给信息编码的密匙事，使用传递盒子的方法（非对称加密

这样就可以将二者的有点兼具了，非对称加密的可靠性和对称加密的高效性。

> > > 交换编码密匙的时候使用非对称加密技术，传送信息的时候使用对称加密

## 参考文献

- https://zhuanlan.zhihu.com/p/100657391
- https://juejin.cn/post/6844903830987997197#heading-7
- https://cloud.tencent.com/developer/article/1748862
