## 自我介绍

晚上好，我先做下自我介绍，我叫，来自河北邢台，17 年毕业于河北科技大学计算机科学与技术专业，目前有两段工作经历，第一段工作经历是中人网深圳分公司，公司主要是做人力资源相关的产品，为什么离职呢？当时因为公司经营出了点状况，发不出工资，然后就换了一家公司，第二段工作经历也就是目前所在的这家公司，，主要是做人工智能与大数据方面的，主要用的技术栈是 vue 及 vue 全家桶，包括 vue-router、vuex、vue-cli 等技术栈，我主要是负责公司承接的产品的前端开发，包括 pc 端、H5 端微信公众号和企业微信公众号、微信小程序等。平时工作之余，也会写一写自己的总结，逛一逛技术社区，看一些书刊等。因为公司的改变了发展策略，与自己的发展规划不太相符合，所以想看看机会。

## 可以介绍下最近做的项目

### 项目背景：

AI 陈列打卡活动，是给四川中烟做的活动，主要是为了提高零售户陈列烟的标准性，积极性。
包括 H5 零售户端、h5 客户经理端、PC 端后台管理系统、数据大屏。
如果零售户想要参加活动，需要先进行申请，客户经理会对其审核通过才能参加活动。
审核通过之后，零售户可以通过访问 H5 端，拍摄摆放烟的陈列照片，进行上传，通过我们公司的算法进行识别，打分，评级，如果陈列的好，获得积分，换取响应的奖励。
如果自认为结果不正确，也可以进行上传审核，到我们的数据后台，由专门的审核人员进行人工复核。数据后台是陈列打卡相关的数据，包括上传照片，打卡人数，得分奖励，发放奖励等数据以及奖励角色的配置
在这个项目中，我是从别人手里接手过来的，后面全权负责整个项目中的零售户端和数据后台端。

### 项目技术：

数据后台和零售户端用的 vue2 及其全家桶，后面零售户端进行重构的时候用的是新的技术栈 vue3 及其全家桶。
vue 全家桶，vue-cli 搭建、vue-router 负责路由、vuex 进行数据管理、axios 进行数据请求，图表使用的是 echarts、地图用了高德 api

### 遇到的问题

1.  解决系统⾸屏加载过慢的问题，由最初的 4s 优化到 2s 左右

    1. 业务背景：活动时间比较久，经手人也比较多，用的东西比较杂，技术方案也没有定好，大家写的时候也没注意，导致这个系统比较慢。
    2. 为什么慢？ 通过 chorme lightHouse performace webpack analise 打包分析预览图 对关键性指标进行了分析，发现单页面打成一个 chunk，js 特别大有**M，css 有**M，首屏加载的字体有\*\*M，加载了一堆的图片，一堆网络请求，以及一些其他的静态资源，导致他加载时间特别长 4s 左右
    3. 如何做的呢？
       减少 js 资源，懒加载，首屏加载的一大部分 js，首屏用不到，第一步：分 chunk，把首屏需要的 js 先加载出来
       怎么做？用 webpack 的插件、vue-router 路由懒加载，根据页面去分

       有一些公共的资源，每次在迭代的过程中，依旧用不到缓存，所以会用 externals 把 cdn 加载进来，虽然首屏加载内容大小不变，但是分成了多个资源，把静态资源更好的利用缓存，更新迭代中，速度加载也会变快。

       其次字体做的懒加载，字体没有加载出来之前，先用系统的字体，字体加载出来之后，再替换系统的字体，更大程度的压缩 js 资源

       还有一些网络方面的优化，比如

       1. 首屏接口没有设计好，一进来会有 20 多个接口请求，后来同后端同学商讨，该合并的合并接口，减少 http 请求
       2. http1.\*升级至 http2 3. dns 优化

       ````js
         1. 减少 DNS 查找(减少域名，至少两个但不超过四个域名，减少 DNS 查找)
                     2. dns-prefetch

                     1. ```JS
                         <link rel- "dns-prefetch" href= "https://fonts.Boof“ />
                         ```

                     2. 尝试在请求资源之前解析域名，减少用户的等待时间，域名解析和内容载入是串行的网络操作


       ````

       3. 图片压缩 tiny

2.  arms 监控，提升稳定性

    1. 定义稳定性指标计算（js 报错率、白屏、网络请求（严苛））
    2. 统计线上稳定性指标
    3. 分析问题在哪，然后解决，如何解决，还要去了解背后是怎么实现的，解决白屏，解决报错，然后再去统计解决之后，线上的稳定性怎么样

    arms 监控的指标：

             1. 应用性能管理（APM）：以探针为核心，全面监控应用程序中每个环节的性能指标，包括响应时间、QPS、内存使用率、CPU 使用率等。通过实时监测，可以发现应用程序的性能瓶颈，从而更好地优化应用性能。
             2. 日志服务（LOG）：收集应用程序输出的日志信息，支持文本、JSON、二进制等多种格式。支持日志实时分析、检索和查询，方便开发者寻找应用程序运行过程中出现的问题。
             3. 页面访问速度：ARMS 前端监控可测量多种页面性能指标，包括首次渲染时间、首屏时间、DOM Ready 时间、资源加载时间等。
             4. JS 错误诊断：ARMS 前端监控的 JS 错误诊断功能可展示 JS 错误的基本信息和分布情况，以及回溯用户行为，帮助您快速定位错误位置。
             5. API 请求监控：ARMS 前端监控能提供应用中每个 API 的调用情况，包括调用成功率、返回信息、成功或失败的平均耗时等。
             6. 前后端链路追踪：前后端链路追踪功能可将 API 请求从前端发出到后端调用的链路串联起来，真实还原代码执行的完整现场。

3.  历史重构
    背景：原来有很多很复杂的逻辑，因为以前同学在维护的时候，没有将整个架构理清楚，包括一些业务的变化，导致现在业务逻辑在上面很复杂，堆叠功能变得很困难，这时候决定着手去重构这个模块的代码

    如何做的：重构之前基于对业务的了解，先去写了大量的测试用例，覆盖了基础的功能，然后同时和测试同学沟通好，会去重构哪些模块的代码，大概的影响范围，回归范围是怎样的，改完代码之后，先去跑测试用例，看下测试用例是不是都能通过，再交给测试同学

    成果及业务价值：修复一些小问题平均需要花费两天，重构完代码之后，逻辑比较简单，注释补全，测试用例也补全了，修改 bug 只需要 0.5 天，迭代更新功能也比较好做，代码更好维护，一个功能做的更快了，同时也统一升级对齐技术栈 vue3

#### 1、地图数据（直接从高德地图中拉下来的数据）

缺点：
1）地图中的数据不是一成不变的，有些地区可能由于政策的改变，由县升级为区
2）地图中的数据会有很多，会增加打包体积，影响加载速度及用户体验
解决：使用了高德地图 api，根据 code 获取地图中的数据，可以有效的减少打包体积（四川省下面的市区、全国）
7.99 MB - 3.52 MB - 5.76 MB（加上全国数据）

vue-cli：@vue/cli 4.3.1
vue：2.5.2

#### 2、路由的按需加载

const RoutersView = () => import( /_ webpackChunkName: 'layout' _/ '../views/routers-view')
用函数包裹起来

#### 3、elementUI 按需加载

打包体积增大

#### 4、webpack 优化

compression-webpack-plugin 开启 gzip；gzip 是需要服务端配置的，当开启时会压缩我们的线上代码，但是如果我们前端已经使用 gzip 压缩过，那么服务端就会直接使用已经压缩好的代码

#### 5、splitChunks chunk-vender 分割代码

chunk-vendors 的 js 文件，这个文件包含了业务代码和一些引入的第三方库代码，所以一般体积比较大，浏览器加载时也耗时更多

其实我们可以将这部分代码做一个分割，分成多个文件，这样浏览器加载时会并行加载，而且对于不变的代码，会直接从缓存中读取，速度得到提升。

#### 6、有了解到可以使用 cdn，但是可能会不稳定

直接配置 config.externals HtmlWebpackPlugin 插件进行引入

cdn 引入的方式虽然能极大改善网页加载速度，但我还是不会用这个功能，项目还不需要非得这样的优化，也怕 cdn 不稳定。觉得需要的还是可以上的

#### 7、图片文件的压缩

上线之前统一进行图片压缩 tiny
或者使用 image-webpack-loader

#### 8、去掉一些没有必要的第三方包

只使用了 lodash 的深拷贝。就可以直接摒弃掉这个库，当然也可以进行按需加载

#### 9、打包第三方包时，忽略一些文件内容

webpack 中的 IgnorePlugin 插件，可以在打包第三方包时忽略一些文件内容，有效减小打包文件体积。一个典型的案例就是忽略 moment 插件的语言包，moment 自带有很多语言包，即使你不用这些包，也会被一起打包了，这时候就可以使用 ignorePlugin 来忽略打包这部分文件，配置插件：

关于时间格式化，我还是喜欢自己去封装，或者可以使用 dayjs 这个库，更轻量化。

#### 10、提升项目构建速度

这个适用于开发环境，每次构建都需要打包引入的第三方模块，如果不打包这些模块，那么构建速度将大大提升，这正是 DllPlugin 要做到的事。

说的明白点就是在构建项目之前，先把一些第三方包打包好，然后项目构建时直接引用这些打包好的第三方包，提升项目构建速度。
